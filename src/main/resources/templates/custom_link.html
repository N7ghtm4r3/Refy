<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <link th:href="@{custom_link.css}" media="screen and (min-device-width: 661px)" rel="stylesheet">
    <link th:href="@{custom_link_mobile.css}" media="screen and (max-device-width: 660px)" rel="stylesheet">
    <link rel="stylesheet" media="screen and (min-device-width: 661px)" href="../static/css/custom_link.css">
    <link rel="stylesheet" media="screen and (max-device-width: 660px)" href="../static/css/custom_link_mobile.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700&display=swap" rel="stylesheet">
    <title th:text="${title}"></title>
    <script type="importmap">
        {
          "imports": {
            "@material/web/": "https://esm.run/@material/web/"
          }
        }
    </script>
    <script type="module">
        import '@material/web/all.js';
        import {styles as typescaleStyles} from '@material/web/typography/md-typescale-styles.js';

        document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
    </script>
    <script>
        function copy() {
           var copyText = document.getElementById("test");
           copyText.select();
           copyText.setSelectionRange(0, 99999);
           navigator.clipboard.writeText(copyText.value);
           alert("Copied the text: " + copyText.value);
        }
    </script>
    <style>
        .hidden {
            display: none;
        }
    </style>
    <script th:inline="javascript">
        /*<![CDATA[*/
            var customLink = /*[[${custom_link}]]*/ {};
            document.addEventListener('DOMContentLoaded', function() {
                var showResources = () => {
                    var validationForm = document.getElementById('validation_form')
                    validationForm.style.display = 'none';
                    var resourcesDiv = document.getElementById('resourcesDiv');
                    resourcesDiv.classList.remove('hidden');
                };
                const linkFields = Object.entries(customLink.fields);
                if(Object.keys(linkFields).length === 0)
                    showResources();
                else {
                    var validateButton = document.getElementById('validateButton');
                    validateButton.addEventListener('click', function() {
                        var validated = true;
                        const formFields = document.querySelectorAll('.form_field');
                        formFields.forEach((field, index) => {
                            const label = field.label;
                            const foundField = linkFields.find(([key, value]) => key === label);
                            if(foundField != null) {
                                const [, value] = foundField;
                                if(value !== field.value) {
                                    validated = false;
                                    field.reportValidity();
                                    field.error = true;
                                    return;
                                }
                            } else {
                                 validated = false;
                                 return;
                            }
                        });
                        if(validated)
                            showResources();
                    });
                }
            });
        /*]]>*/
    </script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
</head>
    <body>
        <div class="container" th:object="${custom_link}">
            <div id="validation_form" class="card">
                <h1 class="main_text" th:text="${main_text}">form_title</h1>
                <div th:each="field : ${custom_link.fields.keySet()}" class="item_field">
                    <md-outlined-text-field
                            class="form_field"
                            th:label="${field}"
                            label="field_key" type="text"
                            required>
                    </md-outlined-text-field>
                </div>
                <div id= "validateButton" class="validate_button">
                    <md-filled-tonal-button th:text="${validate_button_text}">
                        Validate
                        <svg slot="icon" xmlns="http://www.w3.org/2000/svg" height="40px" viewBox="0 0 24 24"
                             width="40px" fill="#e8eaed">
                            <path d="M0 0h24v24H0V0z" fill="none"/><path d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z"/></svg>
                    </md-filled-tonal-button>
                </div>
            </div>
            <div id="resourcesDiv" class="resources hidden">
                <div class="card">
                    <h1 class="main_text" th:text="${resources_title_text}">form_title</h1>
                    <md-list class="resourcesList" style="display:inline-block;">
                        <div th:each="resource : ${custom_link.resources.entrySet()}" class="item_field">
                            <md-list-item>
                                <div slot="headline" th:text="${resource.key}">resource_key</div>
                                <div class="supportingText" slot="supporting-text" th:text="${resource.value}">resource_value</div>
                                <div slot="end">
                                    <md-filled-tonal-icon-button class="copyButton">
                                        <md-icon>content_copy</md-icon>
                                    </md-filled-tonal-icon-button>
                                </div>
                            </md-list-item>
                            <md-divider></md-divider>
                        </div>
                    </md-list>
                    <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            const copyButtons = document.querySelectorAll('.copyButton');
                            copyButtons.forEach((button, index) => {
                                button.addEventListener('click', function() {
                                    const textToCopy = button
                                        .closest('md-list-item')
                                        .querySelector('.supportingText')
                                        .textContent;
                                    navigator.clipboard.writeText(textToCopy)
                                        .then(() => {
                                            alert(`Resource copied!`);
                                        });
                                });
                            });
                        });
                    </script>
                </div>
            </div>
        </div>
    </body>
</html>
